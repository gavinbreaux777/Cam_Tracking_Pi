<html>
    <head>
        <title>Really Cool Thing E's</title>
        <style>
            .grid-container {
                display: grid;
                height: 90vh;
                grid-template-columns: 10% 1fr 1fr 1fr 1fr 10%; /*repeat(3, 1fr);*/
                grid-template-rows: 10% 1fr 1fr 1fr 20%;
                grid-gap: 10px; 
                padding: 10px;
                border: 2px solid green;
                place-items: center;
            }
            .grid-item{
                margin: 0px;
            }
            .btn-style{
                margin: 0 auto 10%; width: 100%; height: auto; font-size: 12;
            }
            .mot-control-grid{
                display: grid;
                height: 100%;
                width: 100%;
                grid-template-columns: 1fr 1fr 1fr;
                grid-template-rows: 1fr 1fr 1fr;
                border: 5px solid purple;
            }
            .mot-control-button{
                height: 100%;
                width: 100%;
            }
            .mot-control-button-container{
                display: flex; 
                justify-content: center; 
                align-items: center;
                border: 2px dashed orange;
            }
            .servo-control-grid{
                display: grid;
                height: 100%;
                width: 100%;
                grid-template-columns: 1fr 1fr 1fr;
                grid-template-rows: 1fr 1fr 1fr 1fr 1fr;
                border: 5px solid gray
            }
            .two-img-grid{
                display: grid;
                height: 100%;
                width: 100%;
                grid-template-columns: 1fr 1fr;
                border: 5px solid green;
            }
        </style>
    </head>

    <body>
        <h1 style="justify-content: center; text-align: center;">Cool Shit</h1>
        <div class="grid-container">
            <div id="left_strip" class="grid-item" style="grid-row: 2; grid-column: 1; border-style: dotted; border-color: green;">
                <button onclick="stopStream()" id="start_stop_stream" class="btn-style">
                    Stop Stream
                </button>
                <button onclick="stopImgMod()" id="start_stop_img_mod" class="btn-style">
                    Stop Image Modificaiton
                </button>
            </div>
            <div id="center_page" class="grid-item" style="grid-row: 2 / 5; grid-column: 2 / 6;  border: 5px dotted red; height: auto; width: 100%">
            </div>
            <div id="top_strip" class="grid-item" style="grid-row: 1; grid-column: 2 / 6; border: 6px dashed burlywood; height: 100%; width: 100%; display: flex; flex-direction: row;">
                <div style="border: 5px dashed cyan;">
                    <button onclick="toggleMainPage()" id="main_page_btn" class="btn-style" >
                    Main Page
                    </button>
                </div>
                <div style="border: 5px dashed blue;">
                    <button onclick="toggleMotControl()" id="mot_ctrl_btn" class="btn-style" >
                    Motor Control
                    </button>
                </div>
                <div style="border: 5px solid magenta;">
                    <button onclick="toggleStreamAndBaseImg()" id="show_base_img_btn" class="btn-style" >
                        Show Base Image
                    </button>
                </div>
                <div style="border: 5px dotted darkorange">
                    <button onclick="toggleCalibration()" id="toggle_calibration" class="btn-style">
                        Calibrate Motors
                    </button>
                </div>
            </div>
            
            
            <div id="bottom-center-section" style="grid-row: 5; grid-column: 3 / 5; height: 100%; width: 100%"></div>
            <div id="bottom-right-section" style="grid-row: 5; grid-column: 5 / 7; height: 100%; width: 100%;"></div>
            <div id="right-strip" style="grid-row: 2 / 5; grid-column: 6; border: 5px solid pink; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center;">
                <div style="border: 2px dashed black;">
                    <label for="objSizeInput">Required Object Size</label>
                    <input oninput="changeImgProcSetting('requiredObjectSize', this.value)" id="objSizeInput" type="number" value="2500" style="width: 50%;"/>
                    <label for="gainInput" style="display:block; margin-top: 10">Analogue Gain</label>
                    <input oninput="changeCamSetting('AnalogueGain', this.value)" id="gainInput" type="number" value="10.0" style="width: 50%;"/>
                </div>
            </div>
        </div>

        </div>
        
        <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
        <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
        <script>
            const pageSections = {
                center: document.getElementById("center_page"),
                bottomCenter: document.getElementById("bottom-center-section"),
                bottomRight: document.getElementById("bottom-right-section"),
                leftStrip: null,
                rightStrip: null,
                topStrip: null
            }
            const serverData = {
                xStepperPosition: 0,
                yStepperPosition: 0,
                servoPosition: 0
            }
        //HTML dynamic components
            class ImageFactory{
                constructor(){}

                static createStreamImage(htmlElementToAppendTo){
                    //create image element
                    const img = document.createElement('img');
                    img.src = '/stream';
                    img.id = 'stream_img';
                    img.style.display = 'block';
                    img.style.margin = '0 auto';
                    img.style.maxHeight = '100%'
                    img.style.maxWidth = '100%'
                    img.style.borderwidth = '2';
                    img.style.borderColor = 'black';
                    img.style.borderstyle = 'solid';

                    //clear the specified element and append the image
                    htmlElementToAppendTo.innerHTML = ""
                    htmlElementToAppendTo.appendChild(img)
                }

                static createBaseImg(htmlElementToAppendTo){
                    const img = document.createElement('img');
                    img.src = '/base-img?cache_buster=' + new Date().getTime();
                    img.id = 'base_img';
                    img.style.display = 'block';
                    img.style.margin = '0 auto';
                    img.style.maxHeight = '100%'
                    img.style.maxWidth = '100%'
                    img.style.borderWidth = '2';
                    img.style.borderColor = 'blue';
                    img.style.borderstyle = 'solid';

                    //clear the specified element and append the image
                    htmlElementToAppendTo.innerHTML = "";
                    htmlElementToAppendTo.appendChild(img);
                }

                static appendImage(htmlElementToAppendTo, src){
                    //create image element
                    const img = document.createElement('img');
                    img.src = src;
                    img.id = 'stream_img';
                    img.style.display = 'block';
                    img.style.margin = '0 auto';
                    img.style.maxHeight = '100%'
                    img.style.maxWidth = '100%'
                    img.style.borderwidth = '2';
                    img.style.borderColor = 'black';
                    img.style.borderstyle = 'solid';

                    //clear the specified element and append the image
                    htmlElementToAppendTo.innerHTML = ""
                    htmlElementToAppendTo.appendChild(img)
                }

                static createDetectedImage(htmlElementToAppendTo){
                    const img = document.createElement('img');
                    img.src = '/detect-img?cache_buster=' + new Date().getTime();
                    img.id = 'detect_img';
                    img.style.display = 'block';
                    img.style.margin = '0 auto';
                    img.style.maxHeight = '100%'
                    img.style.maxWidth = '100%'
                    img.style.borderWidth = '2';
                    img.style.borderColor = 'blue';
                    img.style.borderstyle = 'solid';

                    //clear the specified element and append the image
                    htmlElementToAppendTo.innerHTML = "";
                    htmlElementToAppendTo.appendChild(img);
                }

                static createStreamAndBaseImage(htmlElementToAppendTo){
                    const container = document.createElement('div');
                    container.className = 'two-img-grid';

                    //Create live stream image
                    const streamContainer = document.createElement('div');
                    streamContainer.id = "img_div_one"
                    streamContainer.className = 'mot-control-button-container'
                    streamContainer.style.gridColumn = '1';
                    streamContainer.style.width = '100%';
                    this.createStreamImage(streamContainer)
                    //appendImage(streamContainer, '/stream'); //This works when tied directly to navigation buttons but not here

                    container.appendChild(streamContainer);

                    //Create static base image
                    const baseImgContainer = document.createElement('div');
                    baseImgContainer.id = "img_div_two"
                    baseImgContainer.className = 'mot-control-button-container'
                    baseImgContainer.style.gridColumn = '2';
                    baseImgContainer.style.height = '100%';
                    this.createBaseImg(baseImgContainer)
                    //appendImage(streamContainer, '/base-img?cache_buster=' + new Date().getTime());

                    container.appendChild(baseImgContainer);

                    htmlElementToAppendTo.innerHTML = "";
                    htmlElementToAppendTo.appendChild(container);
                }

            }

            class StepperControl{
                constructor(){
                    this.items = {
                        jogSpeedElement: null
                    }
                }

                createGrid(htmlElementToAppendTo){
                    //grid container for all buttons
                    const container = document.createElement('div')
                    container.className = 'mot-control-grid'

                    //up button
                    const upcontainer = document.createElement('div');
                    upcontainer.className = 'mot-control-button-container';
                    upcontainer.style.gridRow = '1';
                    upcontainer.style.gridColumn = '2';
                    
                    const upButton = document.createElement('button');
                    upButton.className = 'mot-control-button';
                    upButton.onmousedown = () => startJog('up', this.items.jogSpeedElement.value);
                    upButton.onmouseup = stopMotors;
                    upButton.textContent = 'up button';
                    
                    upcontainer.appendChild(upButton);

                    //down button
                    const downContainer = document.createElement('div');
                    downContainer.className = 'mot-control-button-container';
                    downContainer.style.gridRow = '3';
                    downContainer.style.gridColumn = '2';
                    
                    const downButton = document.createElement('button');
                    downButton.className = 'mot-control-button';
                    downButton.onmousedown = () => startJog('down', this.items.jogSpeedElement.value);
                    downButton.onmouseup = stopMotors;
                    downButton.textContent = 'down button';
                    
                    downContainer.appendChild(downButton);

                    //left button
                    const leftContainer = document.createElement('div');
                    leftContainer.className = 'mot-control-button-container';
                    leftContainer.style.gridRow = '2';
                    leftContainer.style.gridColumn = '1';
                    
                    const leftButton = document.createElement('button');
                    leftButton.className = 'mot-control-button';
                    leftButton.onmousedown = () => startJog('left', this.items.jogSpeedElement.value);
                    leftButton.onmouseup = stopMotors;
                    leftButton.textContent = 'left button';
                    
                    leftContainer.appendChild(leftButton);

                    //right button
                    const rightContainer = document.createElement('div');
                    rightContainer.className = 'mot-control-button-container';
                    rightContainer.style.gridRow = '2';
                    rightContainer.style.gridColumn = '3';
                    
                    const rightButton = document.createElement('button');
                    rightButton.className = 'mot-control-button';
                    rightButton.onmousedown = () => startJog('right', this.items.jogSpeedElement.value);
                    rightButton.onmouseup = stopMotors;
                    rightButton.textContent = 'right button';
                    
                    rightContainer.appendChild(rightButton);

                    //speed setting box
                    const speedContainer = document.createElement('div');
                    speedContainer.style.gridRow = '2';
                    speedContainer.style.gridColumn = '2';
                    speedContainer.style.display = 'flex';
                    speedContainer.style.justifyContent = 'center';
                    speedContainer.style.alignItems = 'center';
                    
                    const label = document.createElement('label');
                    label.setAttribute('for', 'speedInput');
                    label.style.marginRight = '10px';
                    label.textContent = 'Jog Speed';
                    
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.id = 'speedInput';
                    input.style.width = '50%';
                    input.value = "10";
                    this.items.jogSpeedElement = input;
                    
                    speedContainer.appendChild(label);
                    speedContainer.appendChild(input);

                    //combine everything
                    container.appendChild(upcontainer)
                    container.appendChild(downContainer)
                    container.appendChild(leftContainer)
                    container.appendChild(rightContainer)
                    container.appendChild(speedContainer)

                    //clear the specified element
                    htmlElementToAppendTo.innerHTML = ""

                    //append to specified element
                    htmlElementToAppendTo.appendChild(container)
                }
            }     

            class ServoControl{

                constructor(){
                    this.items = {
                        targetPositionElement: null,
                        currentPositionElement: null
                    }
                }

                updateData(servoPosition){
                    this.items.currentPositionElement.textContent = servoPosition;
                }

                createGrid(htmlElementToAppendTo){
                    //grid container for all buttons
                    const container = document.createElement('div')
                    container.className = 'servo-control-grid'

                    //title
                    const titleContainer = document.createElement('div');
                    titleContainer.style.gridRow = '1';
                    titleContainer.style.gridColumn = '1 / 5'
                    titleContainer.style.textAlign = 'center';
                    titleContainer.textContent = "Servo Control";
                    titleContainer.style.margin = '5px';

                    container.appendChild(titleContainer);

                    //Current position
                    const leftContainer = document.createElement('div');
                    leftContainer.style.display = 'flex';
                    leftContainer.style.flexDirection = 'column';
                    leftContainer.style.textAlign = 'center';
                    leftContainer.style.justifyItems = 'center';
                    leftContainer.style.alignItems = 'center';
                    leftContainer.className = 'mot-control-button-container';
                    leftContainer.style.gridRow = '2 / 6';
                    leftContainer.style.gridColumn = '1 / 2';
                    
                    const currentPosTitle = document.createElement('div');
                    currentPosTitle.textContent = 'Current Position';
                    leftContainer.appendChild(currentPosTitle);

                    const currentPosValue = document.createElement('div');
                    this.items.currentPositionElement = currentPosValue
                    currentPosValue.id = "servo-pos";
                    currentPosValue.textContent = serverData.xStepperPosition;
                    
                    leftContainer.appendChild(currentPosValue);
                    

                    // Target Position
                    const targetPositionContainer = document.createElement('div');
                    targetPositionContainer.className = 'mot-control-button-container';
                    targetPositionContainer.style.gridRow = '2 / 6';
                    targetPositionContainer.style.gridColumn = '2 / 5';
                    targetPositionContainer.style.display = 'flex';
                    targetPositionContainer.style.flexDirection = 'column';
                    targetPositionContainer.style.textAlign = 'center';
                    targetPositionContainer.style.justifyItems = 'center';
                    targetPositionContainer.style.alignItems = 'center';
                    
                    const moveBtn = document.createElement('button')
                    moveBtn.style.width = '50%';
                    moveBtn.style.height = '100%';
                    moveBtn.textContent = 'Move To Target';

                    targetPositionContainer.appendChild(moveBtn);
                    
                    const label = document.createElement('label');
                    label.setAttribute('for', 'positionInput');
                    label.style.marginRight = '10px';
                    label.textContent = 'Target Position';
                    label.style.marginTop = '5px';
                    
                    const input = document.createElement('input');
                    input.type = 'text';
                    input.id = 'positionInput';
                    input.style.width = '50%';
                    input.value = "10";
                    this.items.targetPositionElement = input

                    moveBtn.onclick = () => {moveServo((this.items.targetPositionElement).value);}
                    
                    targetPositionContainer.appendChild(label);
                    targetPositionContainer.appendChild(input);

                    //combine everything
                    container.appendChild(leftContainer)
                    container.appendChild(targetPositionContainer)

                    //clear the specified element
                    htmlElementToAppendTo.innerHTML = ""

                    //append to specified element
                    htmlElementToAppendTo.appendChild(container)
                }
            }          

            class Calibration{
                constructor(){
                    this.items = {
                        xClickRatio: null,
                        yClickRatio: null,
                        motorCalibrationStartX: null,
                        motorCalibrationStartY: null,
                        crosshairlength: 50
                    }
                }

                createCalibrationPage(htmlElementToAppendTo){
                    ImageFactory.createStreamAndBaseImage(htmlElementToAppendTo)

                    const imgDivTwo = document.getElementById("img_div_two");
                    imgDivTwo.innerHTML = "";
                    imgDivTwo.innerText = "Click in the image to save coordinates"
                    imgDivTwo.style.fontWeight = "bold"

                    const streamImg = document.getElementById("stream_img");
                    console.log("setting cursor to crosshair");
                    streamImg.style.cursor = "crosshair";
                    streamImg.addEventListener('click', (event) => {
                        this.saveLocation(event, streamImg.width, streamImg.height)
                    });
                }

                saveLocation(clickEvent, imgWidth, imgHeight){
                    this.items.xClickRatio = (clickEvent.offsetX - (imgWidth/2)) / imgWidth;
                    this.items.yClickRatio = ((imgHeight/2) - clickEvent.offsetY) / imgHeight;
                    
                    this.items.motorCalibrationStartX = serverData.xStepperPosition;
                    this.items.motorCalibrationStartY = serverData.yStepperPosition;

                    const saveCalibrationBtn = document.createElement("button");
                    saveCalibrationBtn.textContent = "Save Calibration";
                    saveCalibrationBtn.onclick = () => {
                        this.calculateAndPushCalibration()
                    };

                    const imgDivTwo = document.getElementById("img_div_two");
                    imgDivTwo.innerHTML = "";
                    imgDivTwo.appendChild(saveCalibrationBtn);

                    const streamImg = document.getElementById("stream_img")

                    const clickCanvas = document.createElement('canvas');
                    const ctx = clickCanvas.getContext('2d');
                    clickCanvas.width = streamImg.width;
                    clickCanvas.height = streamImg.height;
                    ctx.drawImage(streamImg, 0, 0, clickCanvas.width, clickCanvas.height);
                    
                    ctx.strokeStyle = 'red';
                    ctx.lineWidth = 2;
                    this.items.crosshairlength = 50;
                    
                    //draw crosshair on clicked location
                    drawCrosshair(ctx, clickEvent.offsetX, clickEvent.offsetY, length, 'red', 2)

                    const clickImage = new Image();
                    clickImage.src = clickCanvas.toDataURL();

                    clickImage.onload = () => {
                        imgDivTwo.appendChild(clickImage);
                    }
                }

                calculateAndPushCalibration(){
                    const motorXDelta = this.items.motorCalibrationStartX - serverData.xStepperPosition
                    const motorYDelta = this.items.motorCalibrationStartY - serverData.yStepperPosition

                    const xDegreesPerDetectDistanceRatio = motorXDelta / this.items.xClickRatio
                    const yDegreesPerDetectDistanceRatio = motorYDelta / this.items.yClickRatio
                    console.log("motorCalibrationStart = " + this.items.motorCalibrationStartX + " , " + this.items.motorCalibrationStartY)
                    console.log("currentMotorLocation = " + serverData.xStepperPosition + " , " + serverData.yStepperPosition)
                    console.log("motorDelta = " + motorXDelta + " , " + motorYDelta)
                    console.log("clickLocationRatio = " + this.items.xClickRatio + " , " + this.items.yClickRatio)
                    console.log("steps to pixel ratio = " + xDegreesPerDetectDistanceRatio + " , " + yDegreesPerDetectDistanceRatio)
                    //Push calibration to server
                    sendMotorCalibrationFactors(xDegreesPerDetectDistanceRatio, yDegreesPerDetectDistanceRatio)
                }
            }


            function drawCrosshair(canvasContext, xCenter, yCenter, length, color, width){
                canvasContext.strokeStyle = color;
                canvasContext.lineWidth = width;
                
                canvasContext.beginPath()
                canvasContext.moveTo(xCenter - length/2, yCenter)
                canvasContext.lineTo(xCenter + length/2, yCenter)
                canvasContext.stroke();

                canvasContext.beginPath()
                canvasContext.moveTo(xCenter, yCenter - length/2)
                canvasContext.lineTo(xCenter, yCenter + length/2)
                canvasContext.stroke();
            }

            const imageFactory = new ImageFactory()
            const servoController = new ServoControl() 
            const stepperControl = new StepperControl()
            const calibration = new Calibration()


            //Page navigation
            function toggleMotControl(){
                stepperControl.createGrid(pageSections.bottomCenter)
                servoController.createGrid(pageSections.bottomRight)
            }

            function toggleMainPage(){
                //createStreamImage(pageSections.center)
                ImageFactory.appendImage(pageSections.center, "/stream")
                pageSections.bottomCenter.innerHTML = ""
                pageSections.bottomRight.innerHTML = ""
            }

            function toggleStreamAndBaseImg(){
                ImageFactory.createStreamAndBaseImage(pageSections.center);
            }

            function toggleCalibration(){
                calibration.createCalibrationPage(pageSections.center);
            }

            function displayDetectImg(){
                //ImageFactory.createDetectedImage(pageSections.bottomCenter)
                ImageFactory.appendImage(pageSections.bottomCenter, '/detect-img?cache_buster=' + new Date().getTime());
            }

            //Server requests
            function stopStream(){
                const btn = document.getElementById("start_stop_stream")
                fetch('/stopStream', {
                    method: 'GET'
                    })
                    .then(response => {
                        if (response.status === 200){
                            console.log("Stream stopped. Server response = " + response.body);
                        }
                        else{
                            console.log("Failure to stop stream. Server response: " + response.status);
                        }
                    })
                    .then(data => {
                        btn.innerHTML = "Start Stream"
                        btn.onclick = startStream
                    })
                    .catch(error => {
                        console.error(error)
                    })
                }

            function startStream(){
                const btn = document.getElementById("start_stop_stream")
                const stream = document.getElementById("stream_img")
                fetch('/stream',{
                    method: 'GET'
                })
                .then(response => {
                    if (response.status === 200){
                        console.log("Stream started. Server response = " + response.body);
                        
                    }
                    else{
                        console.log("Server failed to start stream. Server response: " + server.response)
                    }
                })
                .then(data => {
                    stream.src = "/stream"
                    btn.innerHTML = "Stop Stream"
                    btn.onclick = stopStream
                })
                .catch(error => {
                    console.error(error)
                })
            }

            function stopImgMod(){
                const btn = document.getElementById("start_stop_img_mod")
                fetch('/stopImgMod', {
                    method: 'GET'
                    })
                    .then(response => {
                        if (response.status === 200){
                            console.log("Image mod stopped. Server response = " + response.body);
                        }
                        else{
                            console.log("Failure to stop image mod. Server response: " + response.status);
                        }
                    })
                    .then(data => {
                        btn.innerHTML = "Start Image Mod"
                        btn.onclick = startImgMod
                    })
                    .catch(error => {
                        console.error(error)
                    })
                }

            function startImgMod(){
                const btn = document.getElementById("start_stop_img_mod")
                fetch('/startImgMod', {
                    method: 'GET'
                    })
                    .then(response => {
                        if (response.status === 200){
                            console.log("Image mod started. Server response = " + response.body);
                        }
                        else{
                            console.log("Failure to start image mod. Server response: " + response.status);
                        }
                    })
                    .then(data => {
                        btn.innerHTML = "Stop Image Mod"
                        btn.onclick = stopImgMod
                    })
                    .catch(error => {
                        console.error(error)
                    })
                }

            function startJog(direction, speed){
                console.log("Starting jog")
                fetch(`/motorControl/${direction}/${speed}`, {
                    method: 'GET'
                })
                .then(response => {
                    if (response.status == 200){
                        console.log("Server moving motor. Response: " + response.body);
                    }
                    else{
                        console.log("Error while requesting motor move. Response: " + response.status);
                    }
                })
                .catch(error => {
                    console.error(error)
                })
            }

            function stopMotors(){
                console.log("Stopping motors")
                fetch("/stopMotors",{
                    method: 'GET'
                })
                .then(response => {
                    if (response.status == 200){
                        console.log("Server stopping motor. Response: " + response.body);
                    }
                    else{
                        console.log("Error while requesting motor stop. Response: " + response.status);
                    }
                })
                .catch(error => {
                    console.error(error)
                })
            }
            
            function moveServo(target){
                console.log("Moving servo");
                fetch(`/moveServo/${target}`, {
                    method: 'GET'
                })
                .then(response => {
                    if (response.status == 200){
                        console.log("Server moving servo. Response: " + response.body);
                    }
                    else{
                        console.log("Error while requesting servo move. Response: " + response.status);
                    }
                })
                .catch(error => {
                    console.error(error)
                })
            }

            function changeImgProcSetting(settingName, settingValue){
                fetch(`/modImgProcSetting/${settingName}/${settingValue}`, {
                    method: 'GET'
                })
                .then(response => {
                    if (response.status == 200){
                        console.log("Server is modifying setting. Response: " + response.text());
                    }
                    else{
                        console.log("Error while requesting setting modification. Response: " + response.status);
                    }
                })
                .catch(error => {
                    console.error(error)
                })
            }

            function changeCamSetting(settingName, settingValue){
                fetch(`/modCamSetting/${settingName}/${settingValue}`, {
                    method: 'GET'
                })
                .then(response => {
                    if (response.status == 200){
                        console.log("Server is modifying setting. Response: " + response.text());
                    }
                    else{
                        console.log("Error while requesting setting modification. Response: " + response.status);
                    }
                })
                .catch(error => {
                    console.error(error)
                })
            }

            function sendMotorCalibrationFactors(xCalibration, yCalibration){
                fetch(`/calibrateMotors/${xCalibration}/${yCalibration}`, {
                    method: 'GET'
                })
                .then(response => {
                    if (response.status == 200){
                        console.log("Server is setting calibration factors. Response: " + response.text());
                    }
                    else{
                        console.log("Error while requesting setting modification. Response: " + response.status);
                    }
                })
                .catch(error => {
                    console.error(error)
                })
            }
        
            


            //Server Sent Events
            const dataEventSource = new EventSource('/dataEventSoruce');
            dataEventSource.onmessage = function(event) {
                console.log("time:" + JSON.parse(event.data).time);
            };
            dataEventSource.onerror = function() {
                console.error("EventSource failed.");
            };

            const newDetectEventSource = new EventSource('/detectNotifySource');
            newDetectEventSource.onmessage = function(event) {
                console.log("new detection");
                displayDetectImg();
            }
            newDetectEventSource.onerror = function() {
                console.error("EventSource failed");
            }

            const motorLocationSource = new EventSource('/motorLocation');
            motorLocationSource.onmessage = function(event){
                console.log("Current motor location: " + JSON.parse(event.data).xPosition + ", " + JSON.parse(event.data).yPosition);
                console.log("Current servo location: " + JSON.parse(event.data).servoPosition)
                //Get values
                serverData.xStepperPosition = JSON.parse(event.data).xPosition;
                serverData.yStepperPosition = JSON.parse(event.data).yPosition;
                serverData.servoPosition = JSON.parse(event.data).servoPosition;
                //Update values on page
                servoController.updateData(serverData.servoPosition)
            }

            //Embedded functions
            window.onload = function() {
                toggleMainPage();
        }
        </script>
    </body>
</html>